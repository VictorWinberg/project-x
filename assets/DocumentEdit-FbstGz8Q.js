import{r as p,j as e,G as D,F as G,I as O,p as q,m as W,i as Y,k as H,T as J,B as L,S as Q,f as T,l as X,g as C,L as I}from"./index-t4rhldu7.js";import{A as Z,t as R,D as ee,a as S,b as M,c as E,M as N,d as te}from"./useSnackbar-1At0ini6.js";import{u as K}from"./useAssignmentsQueries-CEtbdHv0.js";import{u as P}from"./useCompaniesQueries-zLZ_hFqo.js";import{u as V}from"./useContactsQueries-CtNMv8I-.js";import{C as ae}from"./ContentTabs-DJC06qrw.js";import{F as _,s as ne}from"./FlexGrow-6vHfXHbX.js";import{f as se,b as re,e as oe,a as ce,c as ie,g as le,d as me,D as de}from"./useDocumentsMutations-Bn11-teo.js";import{u as ue,C as $}from"./index.esm-DLf0gF--.js";import{M as w}from"./MoreHoriz-BpFOt3N-.js";import"./Tooltip-Cduvdybu.js";const pe=[{label:"Företag",value:"company"},{label:"Kontakt",value:"contact"},{label:"Uppdrag",value:"assignment"}],A=({onSubmit:c=()=>{},onChange:r,formProps:o,children:f,...j})=>{const{data:x=[]}=V(),{data:m=[]}=K(),{data:d=[]}=P(),{control:u,handleSubmit:y,watch:b,formState:{errors:v}}=ue(o),i=b();p.useEffect(()=>{r==null||r(i)},[r,i]);const g=p.useMemo(()=>{switch(i.entityType){case"company":return d.map(a=>({id:a.companyId,label:a.companyName}));case"contact":return x.map(a=>({id:a.contactId,label:a.contactName}));case"assignment":return m.map(a=>({id:a.assignmentId,label:a.assignmentName}));default:return[]}},[i.entityType,d,x,m]);return e.jsx(_,{...j,children:e.jsxs("form",{onSubmit:y(c),style:{...ne},children:[e.jsxs(D,{container:!0,spacing:2,children:[e.jsx(D,{item:!0,xs:12,sm:6,children:e.jsxs(G,{fullWidth:!0,variant:"outlined",error:!!v.entityType,children:[e.jsx(O,{children:"Typ"}),e.jsx($,{control:u,name:"entityType",defaultValue:"",rules:{required:!0},render:({field:a})=>e.jsxs(q,{label:"Typ",...a,children:[e.jsx(w,{value:"",disabled:!0,children:"Välj typ"}),pe.map(n=>e.jsx(w,{value:n.value,children:n.label},n.value))]})})]})}),e.jsx(D,{item:!0,xs:12,sm:6,children:e.jsx($,{name:"entityId",control:u,rules:{required:!0},render:({field:a})=>e.jsx(Z,{options:g,getOptionKey:n=>n.id,getOptionLabel:n=>n.label,value:g.find(n=>n.id===a.value)||null,onChange:(n,h)=>a.onChange(h?h.id:void 0),renderInput:n=>e.jsx(W,{...n,label:"Länk",variant:"outlined",fullWidth:!0})})})})]}),f]})})},Ie=()=>{const c=Y(),r=H(),{data:o,isLoading:f}=se(c.id==="new"?void 0:c.id),{mutate:j}=re(),{mutate:x}=oe(),{data:m=[]}=P(),{data:d=[]}=V(),{data:u=[]}=K(),{data:y=[],isLoading:b}=ce(c.id==="new"?void 0:{documentId:c.id}),{mutate:v}=ie(),{mutate:i}=le(),{mutate:g}=me(),a=p.useMemo(()=>R(m,"companyId"),[m]),n=p.useMemo(()=>R(d,"contactId"),[d]),h=p.useMemo(()=>R(u,"assignmentId"),[u]),B=t=>{j(t,{onSuccess:s=>r(`/documents/${s}`)})};if(f)return;const U=t=>{switch(t){case"company":return"Företag";case"contact":return"Kontakt";case"assignment":return"Uppdrag";default:return null}},z=(t,s)=>{var l,F,k;switch(t){case"company":return e.jsx(C,{component:I,to:`/dashboard/companies/${s}`,children:(l=a.get(s))==null?void 0:l.companyName});case"contact":return e.jsx(C,{component:I,to:`/dashboard/contacts/${s}`,children:(F=n.get(s))==null?void 0:F.contactName});case"assignment":return e.jsx(C,{component:I,to:`/dashboard/assignments/${s}`,children:(k=h.get(s))==null?void 0:k.assignmentName});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx(J,{variant:"h4",color:"primary",children:o?"Redigera dokument":"Lägg till dokument"}),e.jsx(L,{sx:{my:1}}),e.jsxs(de,{formProps:{defaultValues:o},onSubmit:B,children:[e.jsx(L,{sx:{my:1}}),o&&e.jsx(_,{children:e.jsx(ae,{tabs:[{label:"Referenser",content:e.jsx(ee,{data:y,getRowId:t=>`${t.documentId}-${t.entityType}-${t.entityId}`,state:{isLoading:b},columns:[{accessorKey:"entityType",header:"Typ",enableEditing:!1,Cell:({row:t})=>U(t.original.entityType)},{accessorKey:"entityId",header:"Länk",enableEditing:!1,Cell:({row:t})=>z(t.original.entityType,t.original.entityId)}],renderCreateRowDialogContent:({row:t,table:s})=>e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"h4",color:"primary",children:"Ny referens"}),e.jsx(M,{children:e.jsx(A,{sx:{mt:1},formProps:{defaultValues:{documentId:o.documentId}},onChange:l=>{t._valuesCache=l}})}),e.jsx(E,{children:e.jsx(N,{row:t,table:s,variant:"text"})})]}),renderEditRowDialogContent:({row:t,table:s})=>e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"h4",color:"primary",children:"Redigera referens"}),e.jsx(M,{children:e.jsx(A,{sx:{mt:1},formProps:{defaultValues:t.original},onChange:l=>{t._valuesCache=l}})}),e.jsx(E,{children:e.jsx(N,{row:t,table:s,variant:"text"})})]}),onCreate:t=>v(t),onUpdate:(t,s)=>i({row:t,where:s}),onDelete:t=>g(t)})}]})}),e.jsxs(Q,{spacing:2,direction:"row",sx:{mt:3,ml:"auto"},children:[o&&e.jsx(te,{onClick:()=>x(o,{onSuccess:()=>r("..")}),children:t=>e.jsx(T,{size:"large",variant:"outlined",color:"error",...X(t),children:"Ta bort"})}),e.jsx(T,{size:"large",variant:"outlined",color:"primary",onClick:()=>r(-1),children:"Avbryt"}),e.jsx(T,{size:"large",type:"submit",variant:"contained",color:"primary",children:"Spara"})]})]})]})};export{Ie as default};
