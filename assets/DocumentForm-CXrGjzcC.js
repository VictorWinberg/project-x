import{b as E,u as j,a as y}from"./useSnackbar-CTwr7b0A.js";import{v as S,j as t,m as F,b1 as q,b2 as I,b3 as L,b4 as U,b5 as H,f as D,r as m,B as v,G as x,l as b,S as P}from"./index-BgfxrJYc.js";import{u as B,C as g}from"./index.esm-CusdxDGJ.js";import{F as R,s as C}from"./FlexGrow-CmjRi7id.js";const M=S(t.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload"),T=S(t.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),Y=()=>E({queryKey:["files"],queryFn:U}),_=e=>E({queryKey:["file",e],queryFn:()=>H(e),enabled:!!e}),X=()=>{const e=F(),{showSnackbar:n}=j();return y({mutationFn:q,onSuccess:()=>{e.invalidateQueries({queryKey:["files"]}),n("Dokumentet sparat!")},onError:()=>{n("Ett fel uppstod när dokumentet skulle sparas.","error")}})},J=()=>{const e=F(),{showSnackbar:n}=j();return y({mutationFn:I,onSuccess:()=>{e.invalidateQueries({queryKey:["files"]}),n("Dokumentet uppdatarat!")},onError:()=>{n("Ett fel uppstod när dokumentet skulle uppdateras.","error")}})},Z=()=>{const e=F(),{showSnackbar:n}=j();return y({mutationFn:L,onSuccess:()=>{e.invalidateQueries({queryKey:["files"]}),n("Dokumentet borttaget!")},onError:()=>{n("Ett fel uppstod när dokumentet skulle tas bort.","error")}})},z=({onChange:e,children:n,...r})=>{const o=a=>{var d;const c=(d=a.target.files)==null?void 0:d[0];c&&(e==null||e(c))};return t.jsxs(D,{component:"label",role:void 0,variant:"contained",tabIndex:-1,startIcon:t.jsx(T,{}),...r,children:[n,t.jsx("input",{type:"file",style:{display:"none"},onChange:o})]})};function K(){const[e,n]=m.useState([window.innerWidth,window.innerHeight]);return m.useEffect(()=>{const r=Q(()=>{n([window.innerWidth,window.innerHeight])},200);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),e}const Q=(e,n)=>{let r;return(...o)=>{let a;return clearTimeout(r),r=setTimeout(()=>{a=e(...o)},n),a}},O=["application/pdf","application/json","image/*","text/*","video/*","audio/*"],V=({file:e})=>{const n=K(),r=m.useRef(null),[o,a]=m.useState();if(m.useEffect(()=>{e&&O.some(i=>e.type.match(i))?a(URL.createObjectURL(e)):a(void 0)},[e]),!e||!o)return null;const c=()=>{if(r.current&&r.current.contentWindow){const i=r.current,h=r.current.contentWindow.document,s=i.clientHeight,w=i.clientWidth,l=h.documentElement.scrollHeight,u=h.documentElement.scrollWidth,p=w/u,k=s/l,W=Math.min(p,k);i.style.transform=`scale(${W})`,i.style.transformOrigin="top left",i.style.width=`${u}px`,i.style.height=`${l}px`}},d=()=>e.type.startsWith("image/")?t.jsx("img",{src:o,alt:"Preview",style:{width:"100%",height:"100%",maxHeight:"500px",objectFit:"cover"}}):t.jsx("iframe",{ref:r,src:o,title:"Preview",onLoad:c,style:{width:"100%",height:"500px",border:"none"}},`${n}`);return t.jsx(v,{sx:{mx:-1,overflow:"hidden"},children:t.jsx(v,{sx:{width:"100%",height:"500px",px:1},children:d()},o)})},ee=({onSubmit:e=()=>{},onChange:n,formProps:r,children:o,...a})=>{const{control:c,handleSubmit:d,watch:i,setValue:f,formState:{errors:h}}=B(r),s=i();m.useEffect(()=>{n==null||n(s)},[n,s]);const w=l=>{f("documentName",l.name),f("content",l)};return t.jsx(R,{...a,children:t.jsxs("form",{onSubmit:d(e),style:{...C},children:[t.jsxs(x,{container:!0,spacing:2,children:[t.jsx(x,{item:!0,xs:12,sm:6,children:t.jsx(g,{control:c,name:"documentName",rules:{required:!0},defaultValue:"",render:({field:l,fieldState:u})=>t.jsx(b,{fullWidth:!0,label:"Dokumentnamn",type:"text",margin:"none",...l,error:!!u.error})})}),t.jsx(x,{item:!0,xs:12,sm:6,children:t.jsx(g,{control:c,name:"content",rules:{required:!0},render:({field:l})=>{var u,p;return t.jsx(b,{fullWidth:!0,label:"Fil",type:"text",margin:"none",value:((u=l.value)==null?void 0:u.name)||"",disabled:!0,error:!!h.content,InputProps:{endAdornment:(p=s.content)==null?void 0:p.type}})}})}),t.jsx(x,{item:!0,xs:12,children:t.jsx(V,{file:s.content})}),t.jsx(x,{item:!0,xs:12,children:t.jsxs(P,{spacing:2,direction:"row",children:[t.jsx(z,{onChange:w,children:s.content?"Ersätt fil":"Välj fil"}),t.jsx(D,{startIcon:t.jsx(M,{}),variant:"contained",href:s.content?URL.createObjectURL(s.content):"#",download:s.documentName,disabled:!s.content,children:"Ladda ner"})]})})]}),o]})})};export{ee as D,X as a,J as b,Z as c,_ as d,Y as u};
