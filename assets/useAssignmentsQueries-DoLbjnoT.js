import{r as I,j as t,B as S,G as o,k as c,l as q,m as w,n as v,q as p,s as E,o as y}from"./index-BXQFVdII.js";import{u as Q,C as k}from"./index.esm-BRi1WFy-.js";import{u as K}from"./useContactsQueries-Bml7guwZ.js";import{s as O}from"./FlexGrow-BtPNVSe-.js";import{A as h}from"./Autocomplete-D6m5PRqt.js";import{p as d,t as j,u as x,a as g,b as C}from"./useSnackbar-D5aWAr9t.js";const H=({onSubmit:e=()=>{},onChange:s,formProps:a,children:u,...l})=>{const{data:i=[]}=K(),{register:r,control:F,handleSubmit:P,watch:A}=Q(a),b=A();return I.useEffect(()=>{s==null||s(b)},[s,b]),t.jsx(S,{...l,children:t.jsxs("form",{onSubmit:P(e),style:{...O},children:[t.jsxs(o,{container:!0,spacing:2,children:[t.jsx(o,{item:!0,xs:12,sm:6,children:t.jsx(c,{fullWidth:!0,label:"Uppdragsnamn",type:"text",margin:"none",...r("assignmentName")})}),t.jsx(o,{item:!0,xs:12,sm:6,children:t.jsx(k,{name:"responsiblePersonId",control:F,render:({field:m})=>t.jsx(h,{options:i,getOptionKey:n=>n.contactId,getOptionLabel:n=>n.contactName,value:i.find(n=>n.contactId===m.value)||null,onChange:(n,f)=>m.onChange(f?f.contactId:void 0),renderInput:n=>t.jsx(c,{...n,label:"Uppdragsgivare",variant:"outlined",fullWidth:!0})})})}),t.jsx(o,{item:!0,xs:12,sm:6,children:t.jsx(h,{multiple:!0,options:[],renderInput:m=>t.jsx(c,{...m,label:"Fastigheter",type:"text",...r("relevantFiles")}),limitTags:2,disableCloseOnSelect:!0})}),t.jsx(o,{item:!0,xs:12,sm:6,children:t.jsx(c,{fullWidth:!0,label:"Status",margin:"none",type:"text",...r("status")})}),t.jsx(o,{item:!0,xs:12,sm:6,children:t.jsx(c,{fullWidth:!0,label:"Typ",margin:"none",type:"text",...r("type")})}),t.jsx(o,{item:!0,xs:12,sm:6,children:t.jsx(c,{fullWidth:!0,label:"Arvode",margin:"none",type:"number",...r("fee")})})]}),u]})})},T=async()=>{const e=await p("SELECT * FROM assignments"),s=j(await p("SELECT * FROM contacts"),"contactId"),a=j(await p("SELECT * FROM companies"),"companyId");return e.map(L(s,a))},U=async e=>await E("assignments",{assignmentId:e}),M=async e=>{await q("assignments",d(e,["assignmentName","responsiblePersonId","externalContactPersonId","relevantFiles","fee","type","status"]))},W=async e=>{await w("assignments",d(e,["assignmentName","responsiblePersonId","externalContactPersonId","relevantFiles","fee","type","status"]),d(e,["assignmentId"]))},z=async({assignmentId:e})=>{await v("assignments",{assignmentId:e})};function L(e,s){return a=>{const u=e.get(a.responsiblePersonId),l=u&&s.get(u.companyId),i=e.get(a.externalContactPersonId),r=i&&s.get(i.companyId);return{...a,responsiblePerson:{...u,company:l},externalContactPerson:{...i,company:r}}}}const J=()=>{const e=y(),{showSnackbar:s}=x();return g({mutationFn:M,onSuccess:()=>{e.invalidateQueries({queryKey:["assignments"]}),s("Uppdrag skapat!")}})},V=()=>{const e=y(),{showSnackbar:s}=x();return g({mutationFn:W,onSuccess:()=>{e.invalidateQueries({queryKey:["assignments"]}),s("Uppdrag uppdaterat!")}})},X=()=>{const e=y(),{showSnackbar:s}=x();return g({mutationFn:z,onSuccess:()=>{e.invalidateQueries({queryKey:["assignments"]}),s("Uppdrag borttaget!")}})},Y=()=>C({queryKey:["assignments"],queryFn:T}),Z=e=>C({queryKey:["assignment",e],queryFn:()=>U(e),enabled:!!e});export{H as A,J as a,V as b,X as c,Z as d,Y as u};
