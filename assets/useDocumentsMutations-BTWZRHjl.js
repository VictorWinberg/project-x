import{o as I,j as t,f as S,r as x,B as E,x as R,p as C,s as L,y as P,z as Q,G as h,m as b,S as _,n as y,A as H,E as K}from"./index-CxbkoOcU.js";import{u as U,C as k}from"./index.esm-lUn0xbJi.js";import{F as T,s as B}from"./FlexGrow-Rmd1RqJK.js";import{p as q,g,A as N,u as w,e as j}from"./useSnackbar-BFGzjn0G.js";const O=I(t.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload"),z=I(t.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),A=({onChange:e,children:n,...r})=>{const u=d=>{var m;const l=(m=d.target.files)==null?void 0:m[0];l&&(e==null||e(l))};return t.jsxs(S,{component:"label",role:void 0,variant:"contained",tabIndex:-1,startIcon:t.jsx(z,{}),...r,children:[n,t.jsx("input",{type:"file",style:{display:"none"},onChange:u})]})};function M(){const[e,n]=x.useState([window.innerWidth,window.innerHeight]);return x.useEffect(()=>{const r=V(()=>{n([window.innerWidth,window.innerHeight])},200);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),e}const V=(e,n)=>{let r;return(...u)=>{let d;return clearTimeout(r),r=setTimeout(()=>{d=e(...u)},n),d}},$=["application/pdf","application/json","image/*","text/*","video/*","audio/*"],G=({file:e})=>{const n=M(),r=x.useRef(null),[u,d]=x.useState();if(x.useEffect(()=>{e&&$.some(i=>e.type.match(i))?d(URL.createObjectURL(e)):d(void 0)},[e]),!e||!u)return null;const l=()=>{if(r.current&&r.current.contentWindow){const i=r.current,a=r.current.contentWindow.document,v=i.clientHeight,D=i.clientWidth,s=a.documentElement.scrollHeight,p=a.documentElement.scrollWidth,c=D/p,o=v/s,f=Math.min(c,o);i.style.transform=`scale(${f})`,i.style.transformOrigin="top left",i.style.width=`${p}px`,i.style.height=`${s}px`}},m=()=>e.type.startsWith("image/")?t.jsx("img",{src:u,alt:"Preview",style:{width:"100%",height:"100%",maxHeight:"500px",objectFit:"cover"}}):t.jsx("iframe",{ref:r,src:u,title:"Preview",onLoad:l,style:{width:"100%",height:"500px",border:"none"}},`${n}`);return t.jsx(E,{sx:{mx:-1,overflow:"hidden"},children:t.jsx(E,{sx:{width:"100%",height:"500px",px:1},children:m()},u)})},Y=async e=>await R("document_references",e),X=async e=>{await C("document_references",q(e,["documentId","entityType","entityId"]))},W=async e=>{await L("document_references",q(e,["documentId","entityType","entityId"]))},J=()=>g({queryKey:["documents"],queryFn:P}),re=e=>g({queryKey:["documents",e],queryFn:()=>Q(e),enabled:!!e}),oe=e=>g({queryKey:["document_references",e],queryFn:()=>Y(e),enabled:e&&Object.keys(e).length>0}),se=({onSubmit:e=()=>{},onChange:n,formProps:r,children:u,...d})=>{const{data:l=[]}=J(),{control:m,handleSubmit:i,watch:F,setValue:a,formState:{errors:v,defaultValues:{documentId:D}={}}}=U(r),s=F();x.useEffect(()=>{n==null||n(s)},[n,s]);const p=c=>{a("documentName",c.name),a("content",c)};return x.useEffect(()=>{if(s.documentId){const c=l.find(o=>o.documentId===s.documentId);c&&(a("documentName",c.documentName),a("content",c.content))}else a("documentName",""),a("content",void 0)},[s.documentId,a,l]),t.jsx(T,{...d,children:t.jsxs("form",{onSubmit:i(e),style:{...B},children:[t.jsxs(h,{container:!0,spacing:2,children:[t.jsx(h,{item:!0,xs:12,sm:6,children:t.jsx(k,{control:m,name:"documentName",rules:{required:!0},defaultValue:"",render:({field:c,fieldState:o})=>t.jsx(b,{fullWidth:!0,label:"Dokumentnamn",type:"text",margin:"none",...c,error:!!o.error})})}),t.jsx(h,{item:!0,xs:12,sm:6,children:t.jsx(k,{control:m,name:"content",rules:{required:!0},render:({field:c})=>{var o,f;return t.jsx(b,{fullWidth:!0,label:"Dokument",type:"text",margin:"none",value:((o=c.value)==null?void 0:o.name)||"",disabled:!0,error:!!v.content,InputProps:{endAdornment:(f=s.content)==null?void 0:f.type}})}})}),!D&&t.jsx(h,{item:!0,xs:12,children:t.jsx(k,{name:"documentId",control:m,render:({field:c})=>t.jsx(N,{options:l,getOptionKey:o=>o.documentId,getOptionLabel:o=>o.documentName,value:l.find(o=>o.documentId===c.value)||null,onChange:(o,f)=>c.onChange(f?f.documentId:void 0),renderInput:o=>t.jsx(b,{...o,label:"Existerande dokument",variant:"outlined",fullWidth:!0})})})}),t.jsx(h,{item:!0,xs:12,children:t.jsx(G,{file:s.content})}),t.jsx(h,{item:!0,xs:12,children:t.jsxs(_,{spacing:2,direction:"row",children:[t.jsx(A,{onChange:p,children:s.content?"Ersätt dokument":"Välj dokument"}),t.jsx(S,{startIcon:t.jsx(O,{}),variant:"contained",href:s.content?URL.createObjectURL(s.content):"#",download:s.documentName,disabled:!s.content,children:"Ladda ner"})]})})]}),u]})})},ce=()=>{const e=y(),{showSnackbar:n}=w();return j({mutationFn:H,onSuccess:()=>{e.invalidateQueries({queryKey:["documents"]}),n("Dokumentet sparat!")},onError:()=>{n("Ett fel uppstod när dokumentet skulle sparas.","error")}})},ue=()=>{const e=y(),{showSnackbar:n}=w();return j({mutationFn:r=>Promise.all([K(r),W(r)]),onSuccess:()=>{e.invalidateQueries({queryKey:["documents"]}),e.invalidateQueries({queryKey:["document_references"]}),n("Dokumentet borttaget!")},onError:()=>{n("Ett fel uppstod när dokumentet skulle tas bort.","error")}})},ie=()=>{const e=y(),{showSnackbar:n}=w();return j({mutationFn:X,onSuccess:()=>{e.invalidateQueries({queryKey:["document_references"]}),n("Dokument skapat!")},onError:()=>{n("Ett fel uppstod när dokumentet skulle skapas.","error")}})},ae=()=>{const e=y(),{showSnackbar:n}=w();return j({mutationFn:W,onSuccess:()=>{e.invalidateQueries({queryKey:["document_references"]}),n("Dokument borttaget!")},onError:()=>{n("Ett fel uppstod när dokumentet skulle tas bort.","error")}})};export{se as D,oe as a,ce as b,ie as c,ae as d,ue as e,re as f,J as u};
